<!DOCTYPE html>
<html>
<head>
  <title>Retro RPG</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; color: #fff; font-family: monospace; }
    #mobBook { position: fixed; top: 10px; right: 10px; background: #222; padding: 10px; border: 1px solid #0f0; display: none; z-index: 2; }
    #mobBook h3 { margin: 0 0 5px; }
    #health { position: fixed; top: 10px; left: 10px; padding: 5px; background: #300; border: 1px solid #f00; }
    #controls { position: fixed; bottom: 10px; left: 10px; font-size: 14px; color: #aaa; }
    button { background: #0a0; color: #fff; border: none; padding: 5px 10px; margin: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <div id="health">‚ù§Ô∏è 100</div>
  <div id="mobBook"></div>
  <div id="controls">
    WASD/Arrow keys to move | <button onclick="toggleMobBook()">üìñ Mob Book</button>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let player = { x: 400, y: 300, size: 20, color: "#0f0", health: 100 };
    let keys = {};
    let mobs = [];
    let trees = [];

    const mobTypes = [
      { name: "Sheep", color: "#ccc" },
      { name: "Pig", color: "#f88" },
      { name: "Villager", color: "#ff0" }
    ];

    // Load save data
    function loadGame() {
      const save = JSON.parse(localStorage.getItem("rpgSave"));
      if (save) {
        player = save.player;
        mobs = save.mobs;
        trees = save.trees;
      } else {
        generateWorld();
      }
    }

    // Save game
    function saveGame() {
      localStorage.setItem("rpgSave", JSON.stringify({ player, mobs, trees }));
    }

    function generateWorld() {
      for (let i = 0; i < 30; i++) {
        trees.push({ x: Math.random() * 800, y: Math.random() * 600 });
      }
      for (let i = 0; i < 5; i++) {
        const type = mobTypes[Math.floor(Math.random() * mobTypes.length)];
        mobs.push({ x: Math.random() * 800, y: Math.random() * 600, type });
      }
    }

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.size, player.size);
    }

    function drawTrees() {
      ctx.fillStyle = "#080";
      trees.forEach(t => {
        ctx.fillRect(t.x, t.y, 20, 20);
      });
    }

    function drawMobs() {
      mobs.forEach(m => {
        ctx.fillStyle = m.type.color;
        ctx.fillRect(m.x, m.y, 20, 20);
      });
    }

    function drawHealth() {
      document.getElementById("health").innerHTML = `‚ù§Ô∏è ${player.health}`;
    }

    function toggleMobBook() {
      const book = document.getElementById("mobBook");
      if (book.style.display === "block") {
        book.style.display = "none";
      } else {
        let list = "<h3>Mob Book</h3>";
        mobTypes.forEach(m => {
          list += `<div style="color:${m.color}">‚Ä¢ ${m.name}</div>`;
        });
        book.innerHTML = list;
        book.style.display = "block";
      }
    }

    function update() {
      if (keys["ArrowUp"] || keys["w"]) player.y -= 2;
      if (keys["ArrowDown"] || keys["s"]) player.y += 2;
      if (keys["ArrowLeft"] || keys["a"]) player.x -= 2;
      if (keys["ArrowRight"] || keys["d"]) player.x += 2;

      // Boundaries
      player.x = Math.max(0, Math.min(800 - player.size, player.x));
      player.y = Math.max(0, Math.min(600 - player.size, player.y));

      // Mob interaction
      mobs.forEach(m => {
        if (Math.abs(player.x - m.x) < 20 && Math.abs(player.y - m.y) < 20) {
          player.health = Math.max(0, player.health - 0.05);
        }
      });

      draw();
      saveGame();
    }

    function draw() {
      ctx.fillStyle = "#111";
      ctx.fillRect(0, 0, 800, 600);
      drawTrees();
      drawMobs();
      drawPlayer();
      drawHealth();
    }

    document.addEventListener("keydown", e => keys[e.key] = true);
    document.addEventListener("keyup", e => keys[e.key] = false);

    loadGame();
    setInterval(update, 16);
  </script>
</body>
</html>
